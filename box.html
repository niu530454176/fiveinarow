<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>碰壁反弹</title>
	<style type="text/css">

		.box {
			width: 100px;
			height: 100px;
			border-radius: 50%;
			background: #0F0;
			position: absolute;
		}
	</style>
</head>
<body>
<button id = add-btn>添加小球</button>
<button id="remove-btn">从前删除一个圆</button>
<button id="fast-btn">加速</button>
<button id="flow-btn">减速</button>
<!--<div id="box" class="box" style="left: 0;top: 0;"></div>-->
<script>
	function Box() {  //类
		this.init();
		this.startMove();
		this.addEvents();
	}

	Box.prototype = {
		init: function () {
			this.speed = 5;
			this.isMoving = true;
			this.bLeft = 0;
			this.bTop = 0;
			this.isRight = 1;
			this.isBottom = 1;
			this.createBox();
			this.startMove();
			this.addEvents();
		},
		createBox : function () {
			this.box = document.createElement('div');
			var className = document.createAttribute('class');
			className.value = 'box';
			this.box.setAttributeNode(className);
			this.box.style.backgroundColor = '#'+  parseInt(0xffffff * Math.random()).toString(16);
			document.body.appendChild(this.box);
		},
		removeBox : function () {
			var _this = this;
			_this.stopMove();
			document.body.removeChild(_this.box);
		},
		startMove : function () {
			var _this = this;
			_this.isMoving = true;
			_this.intervalId = setInterval(function () {
				_this.bLeft += _this.speed * _this.isRight;
				_this.bTop += _this.speed * _this.isBottom;
				if (_this.bLeft >= (window.innerWidth - 100)) {
					_this.isRight = -1;
				} else if (_this.bLeft <= 0) {
					_this.isRight = 1;
				}

				if (_this.bTop >= (window.innerHeight - 100)) {
					_this.isBottom = -1;
				} else if (_this.bTop <= 0) {
					_this.isBottom = 1;
				}
				_this.box.style.left = _this.bLeft + 'px';
				_this.box.style.top = _this.bTop + 'px';
			}, 30)
		},
		stopMove : function () {
			var _this = this;
			clearInterval(_this.intervalId);
			_this.isMoving = false;
		},
		addEvents : function () {
			var _this = this;
			_this.box.addEventListener('click', function () {
				if (_this.isMoving) {
					_this.stopMove();
				} else {
					_this.startMove();
				}
			})
		},
		fastSpeed : function () {
			var _this = this;
			_this.speed++
		},
		slowSpeed : function () {
			var _this = this;
			_this.speed--;
			if (_this.speed < 0) {
				_this.speed = 0;
			}
		}
	};

	var addBtn = document.getElementById('add-btn');
	var removeBtn = document.getElementById('remove-btn');
	var boxArr = [];
	addBtn.addEventListener('click', function () {
		var box = new Box();
		boxArr.push(box);
	});

	removeBtn.addEventListener('click', function () {
		if (boxArr.length) {
			var box = boxArr.shift();
			box.removeBox();
		}
	});
	var fastBox = document.getElementById('fast-btn');
	var flowBox = document.getElementById('flow-btn');
	fastBox.addEventListener('click', function () {
		for (var i in boxArr) {
			boxArr[i].fastSpeed();
		}
	});
	flowBox.addEventListener('click', function () {
		for (var i in boxArr) {
			boxArr[i].slowSpeed();
		}
	})
</script>
</body>
</html>